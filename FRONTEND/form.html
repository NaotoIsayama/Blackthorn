<!DOCTYPE html>
<html lang="en">
<head>

    <!--Coded by Naoto Isayama -->

        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-RJ8SVP1XLV"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'G-RJ8SVP1XLV');
        </script>

        <!--metadata-->
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="Blackthorn Tattoo Ink is a fictional tattoo company based in Edmonton, Alberta, founded by award winning artist, Emily Blackthorn">
        <meta name="format-detection" content="telephone=no"> <!--Prevents Safari Default Styling-->
    
        <!-- Social Media Tags -->
        <meta property="og:title" content="BlackThorn Tattoo">
        <meta property="og:description" content="Fictional Tattoo company in Edmonton Alberta">
        <meta property="og:image" content="[]"><!--ADD THIS WHEN HOSTING-->
        <meta property="og:url" content="[Your Website URL]"> <!--ADD THIS WHEN HOSTING-->
        
        <title>Blackthorn Tattoo Ink | Book A Appointment</title>

        <!--css-->
        <link rel="stylesheet" type="text/css" href="styles.css">

        <!--Baskerville SC-->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Baskervville+SC:wght@400..700&display=swap" rel="stylesheet">

        <!--Young Serif-->
        <link href="https://fonts.googleapis.com/css2?family=Young+Serif&display=swap" rel="stylesheet">

        <!--Fav Icon-->
        <link rel="icon" type="image/png" sizes="32x32" href="images/Vector-1.png">
        <link rel="icon" type="image/png" sizes="16x16" href="favicons/Vector.png">
        <link rel="icon" type="image/png" sizes="48x48" href="favicons/Vector-2.png">

        <!-- Flatpickr CSS -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

        
</head>
    <body>

        <!--MOBILE NAV-->
        <header id="mobileNav">
            <div class="mobileNav__options">
            <a id="mobileNav__logo-link" class="border-box" href="index.html">
                <img src="images/logo4.png" id="mobileNav__logo-image" alt="">
            </a>

            <label class="hamburger-menu border-box" for="hamburger-checkbox">
                <input id="hamburger-checkbox" class="hamburger-checkbox" type="checkbox">
            </label> 
            

            <!--Change nav to aside-->
            <nav class="side-menu">
                <ul class="side-menu__nav-links">
                    <li class="sc-title light"><a aria-label="Go to Gallery Page" href="portfolio.html">Portfolio</a></li>
                    <li class="sc-title light"><a aria-label="Go to About Us Page" href="aftercare.html">Aftercare</a></li>
                    <li class="sc-title light"><a aria-label="Go to Contact Page" href="form.html">Book</a></li>
                </ul>
            </nav>   
            </div>
        </header>

        <nav class="nav-padding desktop-nav undo-absolute page-nav bg-dark">
            <a href="/index.html"><img id="footer-logo" src="images/logo4.png"></a>
            <a class="sc-body light" href="/portfolio.html">Portfolio</a>
            <a class="sc-body light" href="/aftercare.html">Aftercare</a>
            <a class="sc-body light" href="/form.html">Book</a>
        </nav>

        <div class="marquee form-hide-marquee">
            <div class="marquee__inner-el">
                <span class="marquee-font span1">BOOK NOW • EDMONTON • TATTOO • BOOK NOW • EDMONTON • TATTOO • BOOK NOW • EDMONTON • TATTOO • BOOK NOW • EDMONTON • TATTOO • BOOK NOW • EDMONTON • TATTOO •</span>
                <span class="marquee-font span2">BOOK NOW • EDMONTON • TATTOO • BOOK NOW • EDMONTON • TATTOO • BOOK NOW • EDMONTON • TATTOO • BOOK NOW • EDMONTON • TATTOO • BOOK NOW • EDMONTON • TATTOO •</span>
            </div>
        </div>

        <section class="contact fade-section" id="contact">
        <div class="form__flex-container">
            <div class="form__image-container">
                <img id="form-image" src="images/form-img.webp">
            </div>
            <div class="form__form-container form-padding">
                <img id="form__flowers-overlay" src="images/flowers-overlay-1.png" alt="an overlay image of flowers">
                <h2 class="sc-subtitle fade" data-speed="fast">Book an <span class="rose">appointment</span></h2>
                <p class="body dev-message-form" data-speed="fast">This form is for demonstration purposes only. Each of these form fields can be customized for your needs, and other form options can be added if needed.
                    In a full version, this form can send both you and the client a email.
                </p>
                <p id="submit-message" class="submit-message sc-medium">Thanks for Reaching out! <br>(This form is purely decorative)</p>
                <form method="post">
                    <!--Name Input-->
                    <div class="form-line fade" data-speed="medium">
                        <label class="sc-medium block">Name</label>
                        <input class="sc-body" placeholder="Your Name">
                    </div>

                    <!--Phone number Input-->
                    <div class="form-line fade" data-speed="medium">
                        <label class="sc-medium block">Phone Number</label>
                        <input class="sc-body" placeholder="Your Phone Number">
                    </div>

                    <!--Email Input-->
                    <div class="form-line fade" data-speed="medium">
                        <label class="sc-medium block">Email</label>
                        <input class="sc-body" placeholder="Your Email">
                    </div>

                        <!--Tattoo Placement Dropdown Menu !!! CONSIDER REPLACEING W/ CHECKBOX-->
                        <div class="form-line fade">
                            <label class="sc-medium block" for="tattoo-location">Tattoo Placement</label>
                            <select class="sc-body" id="tattoo-location" name="tattoo-location" required>
                                <option class="sc-body" value="" disabled selected>Select placement</option>
                                <option class="sc-body" value="shoulder">Shoulder/Upper Arm</option>
                                <option class="sc-body" value="other">Forearm</option>
                                <option class="sc-body" value="other">Upper Back</option>
                            </select>
                        </div>

                    <!--Tattoo location Dropdown Menu !!! CONSIDER REPLACEING W/ CHECKBOX-->
                    <!--Currently have hardcoded values but I will need to eventually implement a dynamic way to 
                    get values  -->
                    <div class="form-line fade">
                        <label class="sc-medium block" for="tattoo-location">Your Location</label>
                        <select class="sc-body" id="tattoo-city" name="tattoo-location" required>
                            <option class="sc-body" value="" disabled selected>Select City</option>
                            <option class="sc-body" value="Calgary">Calgary</option>
                            <option class="sc-body" value="Vancouver">Vancouver</option>
                        </select>
                    </div>
                    
                    <!--Tattoo Details Input-->
                    <div class="form-line fade" data-speed="medium">
                        <label class="sc-medium block">Brief Description of your tattoo</label>
                        <textarea rows="3" class="sc-body" placeholder="I want a dragon tattoo..."></textarea>
                    </div>
                    
                    <!--Reference Photos-->
                    <div class="form-line fade" data-speed="medium">
                        <label class="sc-medium block">Reference Photo</label>
                        <label class="sc-body custom-file-upload" for="reference-photos">
                            <span class="sc-body custom-file-upload__btn-text">UPLOAD REFERENCE PHOTO</span>
                            <input type="file" id="reference-photos" name="reference-photos[]" accept="image/*" multiple>
                        </label>
                    </div>

                    <!--Date picker-->
                    <div class="form-line fade" data-speed="medium">
                        <label class="sc-medium block" for="appointment-date">Appointment Date</label>
                        <span class="line-height-1 body dark">Here you can select a range of dates to block out for this calender. For example, this artist is booked until October 26th.</span>
                        <input class="sc-body" type="text" id="appointment-date" name="appointment-date" placeholder="Select a date">
                    </div>

                    <button id="submit-button" type="submit" class="button sc-medium fade" data-speed="slow">SUBMIT</button>
                </form>
            </div>
        </div>
    </section>

    <footer class="side-padding">
        <div class="footer-top">
            <img id="footer-logo" src="images/logo4_black.png">
            <span><a id="personal-link" href="https://www.naotoisayama.com">Designed By Naoto Isayama</a></span>
        </div>
        <div class="divider"></div>
        <div>
            <span class="copyright">© 2025 Blackthorn Tattoo. All rights reserved</span>
        </div>
    </footer>

    <!--scripts-->
    <script src="updateFileUpload.js"></script>
    <script src="submithandler.js"></script>
    <script src="sectionObserver.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script><!-- Flatpickr JS -->

    <script>
        window.addEventListener('DOMContentLoaded', async () => {

            /* 2025-09-12: So the current issue im having is that 'selectedTrip' will only exist if there
            is a change on the dropdown. Also, the availability logic is flawed, this program currently excludes the 
            days of the week that the artist is scheduled.*/

            // Send POST request on page load
            const response = await fetch('https://blackthorntattoo.naotoisayama.com/.netlify/functions/getAvailability', {
                method: 'POST',
            })
            const data = await response.json();
            window.availabilityData = data;


            // 1. EXTRACT WEEKLY SCHEDULE INTO ARRAY
                // Console logs
            console.log('window.availabilityData is', window.availabilityData);

                // Console.log of weeklySchedule
            console.log('window.availabilityData.weeklySchedule is', window.availabilityData.weeklySchedule);

            let weeklyScheduleArray = window.availabilityData.weeklySchedule; //Extract out the 'weeklySchedule' array for better readability

            const homeCity = weeklyScheduleArray[0].homeCity; // weeklySchedule Array should just be size 1, look into adding restrictions in sanity studio
            const scheduledDaysArray = weeklyScheduleArray.flatMap(s => s.weekdays); //Get scheduled days into a flattened 1-D array

                // Console.log of weeklySchedule *check
            console.log(`Weekly Schedule Array Data is : ${scheduledDaysArray} after processing`);

                // Console.log HOMECITY
            console.log('Home City is: ', homeCity);
                
                /*Function to recurringly enable the scheduled days for flatpcikr
            const recurringEnabledWeekdays = (date) => {
                return enabledWeekdays.includes(date.getDay());
            }*/



            // 2.. EXTRACT ROAD TRIP DATA INTO ARRAY
            // Currently working on implementing conditional calendar view based on user selection of
            // 'location' option
            // Console log extracted
            const roadTrips = window.availabilityData.roadTrips
            console.log('window.availabilityData.roadTrips is', roadTrips);



            // 3.. EXTRACT BLOCKED DATES INTO ARRAY
            // Console log extracted
            console.log('window.availabilityData.blockedDates ', window.availabilityData.bookedDays);

            const bookedDatesArray = window.availabilityData.bookedDays.map(b => b.date);

            console.log('The bookedDatesArray is ', bookedDatesArray);



            // 5.. IMPLEMENT LOGIC FOR LOCATION-BASED FILTERING
            const dropdown = document.getElementById("tattoo-city");

            let selectedValue;
            let selectedTrip;

            // Write function that returns 'false' if date is not in scheduledDaysArray
            // getDay() return the numerical representation of the day of the week, convert it
            // to string since 'scheduledDaysArray' consists of strings
            const recurringDisabledWeekdays = (date) => {
                return !(scheduledDaysArray.includes(date.getDay().toString()));
            }





            /*--------------TESTING GROUNDS------------------------------*/
            
            /*
            dates = [
            new Date(2025, 9, 15), // October 15, 2025
            new Date(2025, 9, 16),
            new Date(2025, 9, 17),
            new Date(2025, 9, 18),
            new Date(2025, 9, 19),
            new Date(2025, 9, 20),
            new Date(2025, 9, 21),
            new Date(2025, 9, 22),
            new Date(2025, 9, 23),
            new Date(2025, 9, 24),
            new Date(2025, 9, 25)
            ]

            console.log('Allowed dates should be: Mondays, Tuesdays, Wednesdays,Thurdays');
            console.log('ScheduledDaysArray is: ', scheduledDaysArray);
            dates.forEach(d => {
                console.log(d.toDateString(), ' is transformed to ', d.getDay(), ' after applying .getDay()');
                console.log(d.toDateString(), ' returns ', scheduledDaysArray.includes(d.getDay().toString()), ' when checking if its included in scheduledDaysArray, and is converted to a string');
                console.log(d.toDateString(), recurringDisabledWeekdays(d));
            });*/

            /*--------------TESTING GROUNDS------------------------------*/




            // Dropdown menu event listener, The initialization for flatpickr is inside here
            dropdown.addEventListener("change", () => {

                // Dropdown option selected
                selectedValue = dropdown.value;

                //console log
                console.log('selectedValue is: ', selectedValue);

                // If selected Value is home city, display schedule - (trip dates + bookedDays)
                // console log comparison
                console.log('The truth value of selectedValue = homeCity is: ', selectedValue === homeCity);
                console.log('The data type of selectedValue is: ', typeof selectedValue);
                console.log('The data type of homeCity is: ', typeof homeCity);
                
                const flatpickrArray = [];

                if (selectedValue === homeCity) {

                    // Loop through road trips, and push a range object to disable array
                    for (let i =  0; i < roadTrips.length; i++) {
                        flatpickrArray.push({
                            from: roadTrips[i].trip.startDate,
                            to: roadTrips[i].trip.endDate
                        })
                    }
                    
                    // Add booked dates array to disabled
                    for (let i = 0; i < bookedDatesArray.length; i++) {
                        flatpickrArray.push(bookedDatesArray[i]);
                    }

                    console.log('The Disabled array, after adding trips and booked dates is: ', flatpickrArray); 

                    flatpickr("#appointment-date", {
                        dateFormat: "Y-m-d",
                        minDate: "today", 
                        disable: [
                            ...flatpickrArray,
                            recurringDisabledWeekdays
                        ]
                    });

                } else {
                    
                    // Find which trip is selected
                    for (let i = 0; i < roadTrips.length; i++) {
                        if (roadTrips[i].trip.city === selectedValue) {
                            flatpickrArray.push({
                                from: roadTrips[i].trip.startDate,
                                to: roadTrips[i].trip.endDate
                            })
                        }
                    }

                    // Add booked dates array to disabled
                    for (let i = 0; i < bookedDatesArray.length; i++) {
                        flatpickrArray.push(bookedDatesArray[i]);
                    }

                    flatpickr("#appointment-date", {
                        dateFormat: "Y-m-d",
                        minDate: "today", 
                        enable: flatpickrArray,
                        disable: bookedDatesArray
                    });


                }
            });
        })           
    </script>

    </body>
</html>