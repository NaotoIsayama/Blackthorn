<!DOCTYPE html>
<html lang="en">
<head>

    <!--Coded by Naoto Isayama -->

        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-RJ8SVP1XLV"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'G-RJ8SVP1XLV');
        </script>

        <!--metadata-->
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="Blackthorn Tattoo Ink is a fictional tattoo company based in Edmonton, Alberta, founded by award winning artist, Emily Blackthorn">
        <meta name="format-detection" content="telephone=no"> <!--Prevents Safari Default Styling-->
    
        <!-- Social Media Tags -->
        <meta property="og:title" content="BlackThorn Tattoo">
        <meta property="og:description" content="Fictional Tattoo company in Edmonton Alberta">
        <meta property="og:image" content="[]"><!--ADD THIS WHEN HOSTING-->
        <meta property="og:url" content="[Your Website URL]"> <!--ADD THIS WHEN HOSTING-->
        
        <title>Blackthorn Tattoo Ink | Book A Appointment</title>

        <!--css-->
        <link rel="stylesheet" type="text/css" href="styles.css">

        <!--Baskerville SC-->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Baskervville+SC:wght@400..700&display=swap" rel="stylesheet">

        <!--Young Serif-->
        <link href="https://fonts.googleapis.com/css2?family=Young+Serif&display=swap" rel="stylesheet">

        <!--Fav Icon-->
        <link rel="icon" type="image/png" sizes="32x32" href="images/Vector-1.png">
        <link rel="icon" type="image/png" sizes="16x16" href="favicons/Vector.png">
        <link rel="icon" type="image/png" sizes="48x48" href="favicons/Vector-2.png">

        <!-- Flatpickr CSS -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

        
</head>
    <body>

        <!--MOBILE NAV-->
        <header id="mobileNav">
            <div class="mobileNav__options">
            <a id="mobileNav__logo-link" class="border-box" href="index.html">
                <img src="images/logo4.png" id="mobileNav__logo-image" alt="">
            </a>

            <label class="hamburger-menu border-box" for="hamburger-checkbox">
                <input id="hamburger-checkbox" class="hamburger-checkbox" type="checkbox">
            </label> 
            

            <!--Change nav to aside-->
            <nav class="side-menu">
                <ul class="side-menu__nav-links">
                    <li class="sc-title light"><a aria-label="Go to Gallery Page" href="portfolio.html">Portfolio</a></li>
                    <li class="sc-title light"><a aria-label="Go to About Us Page" href="aftercare.html">Aftercare</a></li>
                    <li class="sc-title light"><a aria-label="Go to Contact Page" href="form.html">Book</a></li>
                </ul>
            </nav>   
            </div>
        </header>

        <nav class="nav-padding desktop-nav undo-absolute page-nav bg-dark">
            <a href="/index.html"><img id="footer-logo" src="images/logo4.png"></a>
            <a class="sc-body light" href="/portfolio.html">Portfolio</a>
            <a class="sc-body light" href="/aftercare.html">Aftercare</a>
            <a class="sc-body light" href="/form.html">Book</a>
        </nav>

        <div class="marquee form-hide-marquee">
            <div class="marquee__inner-el">
                <span class="marquee-font span1">BOOK NOW • EDMONTON • TATTOO • BOOK NOW • EDMONTON • TATTOO • BOOK NOW • EDMONTON • TATTOO • BOOK NOW • EDMONTON • TATTOO • BOOK NOW • EDMONTON • TATTOO •</span>
                <span class="marquee-font span2">BOOK NOW • EDMONTON • TATTOO • BOOK NOW • EDMONTON • TATTOO • BOOK NOW • EDMONTON • TATTOO • BOOK NOW • EDMONTON • TATTOO • BOOK NOW • EDMONTON • TATTOO •</span>
            </div>
        </div>

        <section class="contact fade-section" id="contact">
        <div class="form__flex-container">
            <div class="form__image-container">
                <img id="form-image" src="images/form-img.webp">
            </div>
            <div class="form__form-container form-padding">
                <img id="form__flowers-overlay" src="images/flowers-overlay-1.png" alt="an overlay image of flowers">
                <h2 class="sc-subtitle fade" data-speed="fast">Book an <span class="rose">appointment</span></h2>
                <p class="body dev-message-form" data-speed="fast">This form is for demonstration purposes only. Each of these form fields can be customized for your needs, and other form options can be added if needed.
                    In a full version, this form can send both you and the client a email.
                </p>
                <p id="submit-message" class="submit-message sc-medium">Thanks for Reaching out! <br>(This form is purely decorative)</p>
                <form method="post">
                    <!--Name Input-->
                    <div class="form-line fade" data-speed="medium">
                        <label class="sc-medium block">Name</label>
                        <input class="sc-body" placeholder="Your Name">
                    </div>

                    <!--Phone number Input-->
                    <div class="form-line fade" data-speed="medium">
                        <label class="sc-medium block">Phone Number</label>
                        <input class="sc-body" placeholder="Your Phone Number">
                    </div>

                    <!--Email Input-->
                    <div class="form-line fade" data-speed="medium">
                        <label class="sc-medium block">Email</label>
                        <input class="sc-body" placeholder="Your Email">
                    </div>

                        <!--Tattoo Placement Dropdown Menu !!! CONSIDER REPLACEING W/ CHECKBOX-->
                        <div class="form-line fade">
                            <label class="sc-medium block" for="tattoo-location">Tattoo Placement</label>
                            <select class="sc-body" id="tattoo-location" name="tattoo-location" required>
                                <option class="sc-body" value="" disabled selected>Select placement</option>
                                <option class="sc-body" value="shoulder">Shoulder/Upper Arm</option>
                                <option class="sc-body" value="other">Forearm</option>
                                <option class="sc-body" value="other">Upper Back</option>
                            </select>
                        </div>

                    <!--Tattoo location Dropdown Menu !!! CONSIDER REPLACEING W/ CHECKBOX-->
                    <div class="form-line fade">
                        <label class="sc-medium block" for="tattoo-location">Your Location</label>
                        <select class="sc-body" id="tattoo-location" name="tattoo-location" required>
                            <option class="sc-body" value="" disabled selected>Select City</option>
                            <option class="sc-body" value="arm">Calgary</option>
                            <option class="sc-body" value="leg">Edmonton</option>
                        </select>
                    </div>
                    
                    <!--Tattoo Details Input-->
                    <div class="form-line fade" data-speed="medium">
                        <label class="sc-medium block">Brief Description of your tattoo</label>
                        <textarea rows="3" class="sc-body" placeholder="I want a dragon tattoo..."></textarea>
                    </div>
                    
                    <!--Reference Photos-->
                    <div class="form-line fade" data-speed="medium">
                        <label class="sc-medium block">Reference Photo</label>
                        <label class="sc-body custom-file-upload" for="reference-photos">
                            <span class="sc-body custom-file-upload__btn-text">UPLOAD REFERENCE PHOTO</span>
                            <input type="file" id="reference-photos" name="reference-photos[]" accept="image/*" multiple>
                        </label>
                    </div>

                    <!--Date picker-->
                    <div class="form-line fade" data-speed="medium">
                        <label class="sc-medium block" for="appointment-date">Appointment Date</label>
                        <span class="line-height-1 body dark">Here you can select a range of dates to block out for this calender. For example, this artist is booked until October 26th.</span>
                        <input class="sc-body" type="text" id="appointment-date" name="appointment-date" placeholder="Select a date">
                    </div>

                    <button id="submit-button" type="submit" class="button sc-medium fade" data-speed="slow">SUBMIT</button>
                </form>
            </div>
        </div>
    </section>

    <footer class="side-padding">
        <div class="footer-top">
            <img id="footer-logo" src="images/logo4_black.png">
            <span><a id="personal-link" href="https://www.naotoisayama.com">Designed By Naoto Isayama</a></span>
        </div>
        <div class="divider"></div>
        <div>
            <span class="copyright">© 2025 Blackthorn Tattoo. All rights reserved</span>
        </div>
    </footer>

    <!--scripts-->
    <script src="updateFileUpload.js"></script>
    <script src="submithandler.js"></script>
    <script src="sectionObserver.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script><!-- Flatpickr JS -->

    <script>

        window.addEventListener('DOMContentLoaded', async () => {

            /* 2025-09-12: So the current issue im having is that 'selectedTrip' will only exist if there
            is a change on the dropdown. Also, the availability logic is flawed, this program currently excludes the 
            days of the week that the artist is scheduled.*/

            // Send POST request on page load
            const response = await fetch('https://blackthorntattoo.naotoisayama.com/.netlify/functions/getAvailability', {
                method: 'POST',
            })
            const data = await response.json();
            window.availabilityData = data;



            // 1. EXTRACT WEEKLY SCHEDULE INTO ARRAY
            // Console logs
            console.log('window.availabilityData is', window.availabilityData);

            // Console.log of weeklySchedule
            console.log('window.availabilityData.weeklySchedule is', window.availabilityData.weeklySchedule);

            let weeklyScheduleArray = window.availabilityData.weeklySchedule; //Extract out the 'weeklySchedule' array for better readability

            const scheduledDaysArray = weeklyScheduleArray.flatMap(s => s.weekdays); //Get scheduled days into a flattened 1-D array

            // Console.log of weeklySchedule *check
            console.log(`Weekly Schedule Array Data is : ${scheduledDaysArray} after processing`);


            // 2.. EXTRACT ROAD TRIP DATA INTO ARRAY
            // Currently working on implementing conditional calendar view based on user selection of
            // 'location' option
            // Console log extracted
            console.log('window.availabilityData is', window.availabilityData.roadTrips);

            const dropdown = document.getElementById("tattoo-location");
            let selectedValue;
            let selectedTrip;

            dropdown.addEventListener("change", () => {

                alert("change event fired");
                /*selectedValue = dropdown.value;
                
                selectedTrip = window.availabilityData.roadTrips.find(
                    (item) => item.trip.city === selectedValue
                );

                if (selectedTrip) {
                    console.log('Matched Trip:', selectedTrip);
                } else {
                    console.warn('No trip found for:', selectedValue);
                }*/
            });

            console.log(selectedTrip); // Should just be an object

            // 3.. EXTRACT BLOCKED DATES INTO ARRAY
            // Console log extracted
            console.log('window.availabilityData.blockedDates ', window.availabilityData.bookedDays);

            const bookedDatesArray = window.availabilityData.bookedDays.map(b => b.date);

            console.log('The bookedDatesArray is ', bookedDatesArray);

            // 4.. MAP WEEKDAY NAMES TO NUMERICAL REPRESENTATION
            // Map the weekly schedule to numerical representations
              const weekdayMap = {
                Sunday: 0,
                Monday: 1,
                Tuesday: 2,
                Wednesday: 3,
                Thursday: 4,
                Friday: 5,
                Saturday: 6,
            };
            
                //This should give me numerical representation of the days that are blocked off in the schedule
            const disabledWeekdays = scheduledDaysArray.map(d => weekdayMap[d]);
                
                //Function to recurringly disable the scheduled days for flatpcikr
            const recurringDisabledWeekdays = (date) => {
                return disabledWeekdays.includes(date.getDay());
            }

            
            // 5.. Condense all blocked dates data into a single array for the 'disable' option in flatpickr
            const flatpickrDisabled = [
                selectedTrip,   // ranges
                ...bookedDatesArray,    // single days
                recurringDisabledWeekdays   // recurring weekdays
            ];
            


            flatpickr("#appointment-date", {
                dateFormat: "Y-m-d",
                minDate: "today", 
                disable: flatpickrDisabled  
            });
        })           
    </script>

    </body>
</html>